---
import { GetBlogsWithLimit } from "@/entities/blog/model/queries";
import BlogItem from "@/entities/blog/ui/BlogItem.astro";

import { GetBlogBySlug } from "@/features/Blog/model/queries";

import PortableText from "@/shared/ui/PortableText/index.astro";

import MainLayout from "@/widgets/MainLayout/index.astro";
import ClickToAction from "@/widgets/ClickToAction.astro";

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect("/blogs");
}
const post = await GetBlogBySlug({ slug });
const latestBlogs = await GetBlogsWithLimit({ limit: 2 });
---

<MainLayout
  title={post.title}
  keyword={post.keyword}
  description={post.description}
>
  <section
    class="container mx-auto mt-32 flex w-full flex-col gap-8 px-6 md:px-8"
  >
    <a href="/blogs">Back to Blog</a>
    <div class="flex flex-col gap-2">
      <h1
        class="text-on-surface dark:text-surface text-2xl font-black uppercase md:text-4xl"
      >
        {post.title}
      </h1>
      <div class="flex flex-col">
        <span class="text-on-surface-secondary text-sm"
          >Publish At: {post.date}</span
        >
        <span class="text-on-surface-secondary text-sm">Tags</span>
      </div>
    </div>
    <div>Header Image</div>
  </section>
  <section
    class="container mx-auto mb-12 grid w-full grid-cols-1 px-6 md:grid-cols-3 md:px-8"
  >
    <div
      class="dark:text-surface text-on-surface-secondary col-span-2 row-span-2"
    >
      <PortableText value={post.content} />
    </div>
    <div class="flex flex-col gap-6">
      {latestBlogs.map((blog) => <BlogItem {...blog} />)}
    </div>
  </section>
  <ClickToAction />
</MainLayout>
